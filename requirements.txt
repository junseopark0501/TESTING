folium
streamlit_folium
pip install streamlit yfinance plotly pandas
import streamlit as st
import yfinance as yf
import pandas as pd
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import datetime
pip install -r requirements.txt

st.set_page_config(layout="wide")

st.title("ğŸ“ˆ ê¸€ë¡œë²Œ ì‹œê°€ì´ì•¡ Top 10 ê¸°ì—… ì£¼ê°€ ë³€í™” (ìµœê·¼ 1ë…„)")
st.markdown("Yahoo Finance ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì£¼ìš” ê¸°ì—…ë“¤ì˜ ì£¼ê°€ ë³€í™”ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.")

# ê¸€ë¡œë²Œ ì‹œê°€ì´ì•¡ Top 10 ê¸°ì—… (ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” í‹°ì»¤)
# ì‹¤ì œ ì‹œê°€ì´ì•¡ ìˆœìœ„ëŠ” ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
# ì—¬ê¸°ì— í¬í•¨ëœ í‹°ì»¤ëŠ” ëŒ€í‘œì ì¸ ê¸€ë¡œë²Œ ëŒ€ê¸°ì—…ë“¤ì…ë‹ˆë‹¤.
# ë” ì •í™•í•œ ìµœì‹  Top 10 ë¦¬ìŠ¤íŠ¸ëŠ” ë³„ë„ë¡œ í™•ì¸ í›„ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.
top_10_tickers = {
    "Apple": "AAPL",
    "Microsoft": "MSFT",
    "NVIDIA": "NVDA", # ìµœê·¼ ê¸‰ë“±ìœ¼ë¡œ Top 10 ì§„ì…
    "Alphabet (GOOGL)": "GOOGL",
    "Alphabet (GOOG)": "GOOG",
    "Amazon": "AMZN",
    "Meta Platforms": "META",
    "Saudi Aramco": "2222.SR", # ì‚¬ìš°ë”” ì£¼ì‹ (Yahoo Finance í‹°ì»¤)
    "TSMC": "TSM", # ëŒ€ë§Œ ì£¼ì‹
    "Tesla": "TSLA", # ìµœê·¼ ë³€ë™ì„±ì´ í¼
    "Berkshire Hathaway": "BRK-B",
    "Eli Lilly": "LLY", # í—¬ìŠ¤ì¼€ì–´ ì„¹í„° ê°•ì„¸
}

# ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ê¸°ê°„ ì„¤ì • (ìµœê·¼ 1ë…„)
end_date = datetime.date.today()
start_date = end_date - datetime.timedelta(days=365)

# --- ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ---
@st.cache_data
def get_stock_data(tickers, start, end):
    data = yf.download(list(tickers.values()), start=start, end=end)
    return data['Adj Close']

with st.spinner("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”."):
    stock_data = get_stock_data(top_10_tickers, start_date, end_date)

if stock_data.empty:
    st.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í‹°ì»¤ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")
else:
    st.subheader("ê¸°ì—…ë³„ ìµœê·¼ 1ë…„ ì£¼ê°€ ë³€í™”")

    # ëª¨ë“  ì£¼ê°€ë¥¼ ì‹œì‘ì ìœ¼ë¡œ ì •ê·œí™” (ì¸ë±ìŠ¤ 100 ê¸°ì¤€)
    normalized_data = stock_data.div(stock_data.iloc[0]) * 100

    # --- Plotly ì‹œê°í™” ---
    fig = make_subplots(rows=1, cols=1)

    for company_name, ticker in top_10_tickers.items():
        if ticker in normalized_data.columns:
            fig.add_trace(
                go.Scatter(
                    x=normalized_data.index,
                    y=normalized_data[ticker],
                    mode='lines',
                    name=company_name,
                    hovertemplate=f'<b>{company_name}</b><br>' +
                                  'ë‚ ì§œ: %{x|%Y-%m-%d}<br>' +
                                  'ì •ê·œí™”ëœ ì£¼ê°€: %{y:.2f}<extra></extra>'
                )
            )

    fig.update_layout(
        title_text=f"ê¸€ë¡œë²Œ ì‹œê°€ì´ì•¡ Top 10 ê¸°ì—… ì£¼ê°€ ë³€í™” (ì •ê·œí™”, {start_date} ~ {end_date})",
        xaxis_title="ë‚ ì§œ",
        yaxis_title="ì •ê·œí™”ëœ ì£¼ê°€ (ì‹œì‘ì  100 ê¸°ì¤€)",
        hovermode="x unified",
        height=600,
        legend_title="ê¸°ì—…",
        template="plotly_dark" # ë˜ëŠ” "plotly", "ggplot2", "seaborn" ë“±
    )
    fig.update_xaxes(
        rangeselector=dict(
            buttons=list([
                dict(count=1, label="1m", step="month", stepmode="backward"),
                dict(count=6, label="6m", step="month", stepmode="backward"),
                dict(count=1, label="1y", step="year", stepmode="backward"),
                dict(step="all")
            ])
        )
    )

    st.plotly_chart(fig, use_container_width=True)

    st.markdown("---")
    st.subheader("ì›ë°ì´í„° (ì¡°ì • ì¢…ê°€)")
    st.dataframe(stock_data.tail())

    st.subheader("ì •ê·œí™”ëœ ë°ì´í„° (ì‹œì‘ì  100 ê¸°ì¤€)")
    st.dataframe(normalized_data.tail())

    st.markdown("""
    **ì°¸ê³ :**
    * ì—¬ê¸°ì— í¬í•¨ëœ 'Top 10 ê¸°ì—…' ëª©ë¡ì€ ì˜ˆì‹œì´ë©°, ì‹¤ì œ ì‹œê°€ì´ì•¡ ìˆœìœ„ëŠ” ì‹œì‹œê°ê° ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        ê°€ì¥ ìµœì‹  ì‹œê°€ì´ì•¡ ìˆœìœ„ëŠ” ê¸ˆìœµ ì •ë³´ ì›¹ì‚¬ì´íŠ¸(ì˜ˆ: CompaniesMarketCap.com, Yahoo Finance)ì—ì„œ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
    * `yfinance` ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” Yahoo Financeì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë©°, ì¼ë¶€ í•´ì™¸ ì£¼ì‹(ì˜ˆ: ì‚¬ìš°ë”” ì•„ëŒì½”)ì€ í‹°ì»¤ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    * ì£¼ê°€ ë°ì´í„°ëŠ” `Adj Close` (ì¡°ì • ì¢…ê°€)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•©ë‹ˆë‹¤.
    * ì‹œê°í™”ëœ ë°ì´í„°ëŠ” ì‹œì‘ì ì„ 100ìœ¼ë¡œ ì •ê·œí™”í•˜ì—¬ ìƒëŒ€ì ì¸ ë³€í™”ë¥¼ ë¹„êµí•˜ê¸° ì‰½ê²Œ í•©ë‹ˆë‹¤.
    """)
